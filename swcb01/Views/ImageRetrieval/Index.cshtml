@model List<swcb01.Models.ImageModel>

@{
    ViewBag.Title = "Index";
}


<style>
    #ImageRetrieval {
        display: inline-flex;
    }


    #QueryImage {
        display: inline-block;
        text-align:center
    }

    #QueryDes {
        
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        padding: 0 4px;
    }

    .column {
        flex: 20%;
        max-width: 20%;
        padding: 0 4px;
        position: relative;
    }

        .column img {
            margin-top: 8px;
            vertical-align: middle;
            width: 100%;
        }

    .imgDes {
        opacity: 0;
        position: absolute;
        top: 0px;
        left: 0px;
        margin-top: 8px;
        background-color: white;
        border: 2px solid red;
        transition: 0.5s;
        width: 100%;
        height: 100%;
    }

        /*.imgDes:hover {
            opacity: 1;
        }*/



    .center {
        height: 450px;
    }

    @@media screen and (max-width: 800px) {
        .column {
            flex: 50%;
            max-width: 50%;
        }
    }

    /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
    @@media screen and (max-width: 600px) {
        .column {
            flex: 100%;
            max-width: 100%;
        }
    }

    .QueryText {
        display: inline-block;
        margin-right:1%;
    }

    .item-1 {
        flex:0.5;
        flex-shrink:0
    }

    .item-0 {
        flex: 0.1;
    }

    .item-2 {
        flex:1.5;
        margin-left: 15px;
    }

    .item-3 {
        flex:2;
        padding:5px;
        border: 2px solid black;
        margin-left: 15px;
        height:80%
    }

    #QueryContainer {
        display: inline-flex;
        width: 100%;
        height: 50%;
        align-items: center;
        /*justify-content: center;*/
    }

    
</style>

<div class="center">
    <h2>上傳查詢影像</h2><br />
    <div id="ImageRetrieval">
        <form action="@Url.Action("Index")" method="post" enctype="multipart/form-data">
            <input type="file" name="file" id="file" /><br />
            <input type="submit" value="開始查詢" />
        </form>
    </div>


    @{
        if (Model == null || Model.Count == 0)
        {
            <div id="QueryContainer">
                
                <div id="QueryImage" class="item-1">
                    <div >查詢影像 :</div>
                    <img src="" width="150" height="150" id="preview" onerror="this.onerror=null; this.src='@Url.Content("~/pyScripts/default.jpg")'">
                </div>
            </div>
           
        }
        else
        {
            <div id="QueryContainer">
                

                <div id="QueryImage" class="item-2">
                    <div>查詢影像 :</div>
                    <img src="@Url.Content("~/SearchImage/"+ViewBag.FileName)" width="200" height="150" id="preview" alt="請上傳查詢影像">
                </div>

                <div class="item-3" >
                    <div>影像描述</div>
                    <div id="QueryDes">hello</div>
                </div>
            </div>

            


            <div class="row">
                @{
                    foreach (swcb01.Models.ImageModel img in Model.Take(5))
                    {
                        <div class="column">
                            <img src="@Url.Content("~/CCTV/"+img.name)">
                            <div class="imgDes" onmouseover="displayDescription(this)">
                                @img.description
                            </div>
                        </div>
                    }
                }
            </div>
                <hr />
                <div class="row">
                    @{
                        foreach (swcb01.Models.ImageModel img in Model.Skip(5).Take(5))
                        {
                            <div class="column">
                                <img src="@Url.Content("~/CCTV/"+img.name)">
                                <div class="imgDes" onmouseover="displayDescription(this)">
                                    @img.description
                                </div>
                            </div>
                        }
                    }
                </div>

                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

                <script type="text/javascript">
                    function DeleteFile(filename) {

                        $.ajax({
                            url: '/api/ImageRetrievalAPI',
                            method: 'POST',
                            dataType: 'json',
                            contentType: 'application/json; charset=utf-8',
                            data: '{"name":"' + filename+'"}',
                            success: function (data) {
                            },
                            fail: function (jqXHR, textStatus) {
                            }
                        })
                    }

                    
                    var filename = "@ViewBag.FileName";
                    DeleteFile(filename)
                </script>

                        }

    }
</div>

@section Scripts{

    <script>
        var fileTag = document.getElementById("file");
        var preview = document.getElementById("preview");

        fileTag.addEventListener("change", function () {
            changeImage(this);
        });

       

        function displayDescription(input) {
            var imgDes = document.getElementById("QueryDes")
            imgDes.innerHTML = input.innerHTML;
        }

        function changeImage(input) {
            var reader;

            if (input.files && input.files[0]) {
                reader = new FileReader();

                reader.onload = function (e) {
                    preview.setAttribute('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

    //function DesForPhone(x) {
    //    x.style.opacity = 1;
    //}
    </script>
}

